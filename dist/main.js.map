{"version":3,"sources":["../main.js"],"names":["require","autoUpdater","log","BrowserWindow","app","SerialPort","Readline","parsers","path","url","regex","currentEnvironment","process","env","NODE_ENV","isOnline","possibleComNames","logger","transports","file","level","info","mainWindow","units","status","windowOptions","center","minWidth","minHeight","width","height","readLine","line","parsedLine","stableString","m","exec","index","lastIndex","undefined","console","closeWindow","closeMessage","close","setInterval","then","online","initSerialPort","comName","port","parser","list","err","ports","forEach","tempPort","includes","pipe","on","data","currentWeight","code","webContents","getURL","executeJavaScript","createWindow","addDevToolsExtension","openDevTools","loadURL","checkForUpdatesAndNotify","quit"],"mappings":";;eAAwBA,QAAS,kBAAT,C;IAAhBC,W,YAAAA,W;;AACR,IAAMC,MAAkBF,QAAS,cAAT,CAAxB;;gBAE+BA,QAAS,UAAT,C;IAAvBG,a,aAAAA,a;IAAeC,G,aAAAA,G;;AACvB,IAAMC,aAAyBL,QAAS,YAAT,CAA/B;AACA,IAAMM,WAAyBD,WAAWE,OAAX,CAAmBD,QAAlD;AACA,IAAME,OAAyBR,QAAS,MAAT,CAA/B;AACA,IAAMS,MAAyBT,QAAS,KAAT,CAA/B;AACA,IAAMU,QAAyB,iCAA/B;AACA,IAAMC,qBAAyBC,QAAQC,GAAR,CAAYC,QAA3C;AACA,IAAMC,WAAyBf,QAAS,WAAT,CAA/B;AACA,IAAMgB,mBAAyB,CAC7B,mBAD6B,EAE7B,MAF6B,EAG7B,MAH6B,EAI7B,MAJ6B,EAK7B,MAL6B,EAM7B,MAN6B,EAO7B,MAP6B,EAQ7B,MAR6B,EAS7B,MAT6B,EAU7B,MAV6B,CAA/B,C,CAWG;;AAEHf,YAAYgB,MAAZ,GAA2Cf,GAA3C;AACAD,YAAYgB,MAAZ,CAAmBC,UAAnB,CAA8BC,IAA9B,CAAmCC,KAAnC,GAA2C,MAA3C;AACAlB,IAAImB,IAAJ,CAAU,iBAAV;;AAEA;AACA;AACA,IAAIC,mBAAJ;AAAA,IAAgBC,cAAhB;AAAA,IAAuBC,eAAvB;;AAEA,IAAIC,gBAAgB;AAClBC,UAAQ,IADU;AAElBC,YAAU,IAFQ;AAGlBC,aAAW,GAHO;AAIlBC,SAAO,IAJW;AAKlBC,UAAQ;AALU,CAApB;;AAQA,SAASC,QAAT,CAAmBC,IAAnB,EAAyB;AACvB,MAAIC,aAAa,OAAjB;AACA,MAAIC,qBAAJ;AACA,SAAM,CAACC,IAAIzB,MAAM0B,IAAN,CAAYJ,IAAZ,CAAL,MAA6B,IAAnC,EAAyC;AAC1C;AACA,QAAGG,EAAEE,KAAF,KAAY3B,MAAM4B,SAArB,EAAgC;AAC9B5B,YAAM4B,SAAN;AACD;AACDf,YAAeY,EAAG,CAAH,CAAf;AACAF,iBAAeE,EAAG,CAAH,CAAf;AACAD,mBAAeC,EAAG,CAAH,CAAf;AACE;AACD,MAAGD,iBAAiBK,SAApB,EAA+B;AAChCf,aAASU,YAAT;AACE;AACDM,UAAQtC,GAAR,CAAa,SAAb,EAAwBsB,MAAxB;AACA,SAAOS,UAAP;AACD;;AAED,SAASQ,WAAT,GAAiE;AAAA,MAA3CC,YAA2C,uEAA5B,0BAA4B;;AAC/DpB,aAAWqB,KAAX;AACAH,UAAQtC,GAAR,CAAa,2BAA2BwC,YAAxC;AACD;;AAED;AACAE,YAAa;AAAA,SAAM7B,WAAW8B,IAAX,CAAiB,kBAAU;AAC3C,QAAGC,WAAW,IAAd,EAAoB;AACrBL,kBAAa,yBAAb;AACE;AACF,GAJiB,CAAN;AAAA,CAAb,EAIM,IAJN;;AAQA;AACA,SAASM,cAAT,GAAyB;AACvB,MAAIC,UAAW,EAAf;AACA,MAAIC,aAAJ;AACA,MAAMC,SAAS,IAAI5C,QAAJ,EAAf;;AAEA,MAAI;AACLD,eAAW8C,IAAX,CAAiB,UAAEC,GAAF,EAAOC,KAAP,EAAkB;AACjCA,YAAMC,OAAN,CAAe,UAAEC,QAAF,EAAgB;AAChC,YAAGvC,iBAAiBwC,QAAjB,CAA2BD,SAASP,OAApC,CAAH,EAAkD;AAChDA,oBAAUO,SAASP,OAAnB;AACAC,iBAAU,IAAI5C,UAAJ,CAAgB2C,OAAhB,CAAV;AACAC,eAAKQ,IAAL,CAAWP,MAAX;;AAEAD,eAAKS,EAAL,CAAS,OAAT,EAAkB,YAAU;AAC7BlB,oBAAQtC,GAAR,CAAa,uBAAb;AACAuC,wBAAa,uBAAb;AACE,WAHD;;AAKA;AACA;AACAS,iBAAOQ,EAAP,CAAW,MAAX,EAAmB,UAAUC,IAAV,EAAgB;AACpC,gBAAIC,gBAAgB7B,SAAU4B,IAAV,CAApB;AACAnB,oBAAQtC,GAAR,CAAa,kBAAb,EAAiC0D,aAAjC;;AAEA,gBAAIC,4HAC0DD,aAD1D,+EAE8DpC,MAF9D,8EAG6DD,KAH7D,+BAAJ;;AAMA,gBAAGD,WAAWwC,WAAX,CAAuBC,MAAvB,GAAgCP,QAAhC,CAA0C,oBAA1C,CAAH,EAAqE;AACnEhB,sBAAQtC,GAAR,CAAa,SAAb;AACAoB,yBAAWwC,WAAX,CAAuBE,iBAAvB,CAA0CH,IAA1C;AACD;AACC,WAdD;AAeD;AACC,OA7BD;AA8BD,KA/BD;AAgCE,GAjCD,CAkCA,OAAMT,GAAN,EAAW;AACZX,gBAAa,yBAAb;AACAD,YAAQtC,GAAR,CAAa,qBAAqBkD,GAAlC;AACE;AACF;;AAGD;AACA,SAASa,YAAT,GAAuB;;AAErB;AACA3C,eAAa,IAAInB,aAAJ,CAAmBsB,aAAnB,CAAb;;AAGA;AACA;AACA;AACA,MAAGd,uBAAuB,KAA1B,EAAiC;AAClCR,kBAAc+D,oBAAd,CAAoC,+GAApC;AACA;AACA5C,eAAWwC,WAAX,CAAuBK,YAAvB;AACA7C,eAAW8C,OAAX,CAAoB,uBAApB;AACE,GALD,MAMK,IAAGzD,uBAAuB,QAA1B,EAAoC;AAC1C;AACAW,eAAWwC,WAAX,CAAuBK,YAAvB;AACA7C,eAAW8C,OAAX,CAAoB,uBAApB;AACE,GAJI,MAKA;AACN;AACA9C,eAAW8C,OAAX,CAAoB,8BAApB;AACE;AACD;AACA9C,aAAWoC,EAAX,CAAe,QAAf,EAAyB,YAAU;AACpC;AACA;AACA;AACApC,iBAAa,IAAb;AACE,GALD;AAMAA,aAAWwC,WAAX,CAAuBJ,EAAvB,CAA2B,iBAA3B,EAA8C,YAAU;AACzDX;AACE,GAFD;AAGD;;AAGD;AACA;AACA;AACA3C,IAAIsD,EAAJ,CAAQ,OAAR,EAAiB,YAAU;AACzBzD,cAAYoE,wBAAZ;AACAJ;AACD,CAHD;;AAKA;AACA7D,IAAIsD,EAAJ,CAAQ,mBAAR,EAA6B,YAAU;AACrC;AACA;AACAtD,MAAIkE,IAAJ;AACD,CAJD;;AAMAlE,IAAIsD,EAAJ,CAAQ,UAAR,EAAoB,YAAU;AAC5B;AACA;AACA,MAAGpC,eAAe,IAAlB,EAAwB;AACzB2C;AACE;AACF,CAND","file":"main.js","sourcesContent":["const { autoUpdater } = require( 'electron-updater' );\r\nconst log             = require( 'electron-log' );\r\n\r\nconst { BrowserWindow, app } = require( 'electron' );\r\nconst SerialPort             = require( 'serialport' );\r\nconst Readline               = SerialPort.parsers.Readline;\r\nconst path                   = require( 'path' );\r\nconst url                    = require( 'url' );\r\nconst regex                  = /(ST|US),GS,\\s+([0-9.]+)(lb|kb)/g;\r\nconst currentEnvironment     = process.env.NODE_ENV;\r\nconst isOnline               = require( 'is-online' );\r\nconst possibleComNames       = [\r\n  \"/dev/cu.usbserial\",\r\n  'COM1',\r\n  'COM2',\r\n  'COM3',\r\n  'COM4',\r\n  'COM5',\r\n  'COM6',\r\n  'COM7',\r\n  'COM8',\r\n  'COM9',\r\n]; //dev/tty.usbserial = MAC ; COM3 = Windows\r\n\r\nautoUpdater.logger                       = log;\r\nautoUpdater.logger.transports.file.level = 'info';\r\nlog.info( 'App starting...' );\r\n\r\n// Keep a global reference of the window object, if you don't, the window will\r\n// be closed automatically when the JavaScript object is garbage collected.\r\nlet mainWindow, units, status;\r\n\r\nlet windowOptions = {\r\n  center: true,\r\n  minWidth: 1000,\r\n  minHeight: 768,\r\n  width: 1366,\r\n  height: 768,\r\n};\r\n\r\nfunction readLine( line ){\r\n  let parsedLine = '0.000';\r\n  let stableString;\r\n  while((m = regex.exec( line )) !== null) {\r\n\t// This is necessary to avoid infinite loops with zero-width matches\r\n\tif(m.index === regex.lastIndex) {\r\n\t  regex.lastIndex++;\r\n\t}\r\n\tunits        = m[ 3 ];\r\n\tparsedLine   = m[ 2 ];\r\n\tstableString = m[ 1 ];\r\n  }\r\n  if(stableString !== undefined) {\r\n\tstatus = stableString;\r\n  }\r\n  console.log( \"Status \", status );\r\n  return parsedLine;\r\n}\r\n\r\nfunction closeWindow( closeMessage = 'you did something wrong.' ){\r\n  mainWindow.close();\r\n  console.log( 'Window closed because ' + closeMessage );\r\n}\r\n\r\n// Check that the PC has internet once the window is open every couple seconds\r\nsetInterval( () => isOnline().then( online => {\r\n\t  if(online !== true) {\r\n\t\tcloseWindow( 'you have lost internet.' );\r\n\t  }\r\n\t} ), 1000\r\n);\r\n\r\n\r\n/** Serial Port Stuff **/\r\nfunction initSerialPort(){\r\n  let comName  = '';\r\n  let port;\r\n  const parser = new Readline();\r\n  \r\n  try {\r\n\tSerialPort.list( ( err, ports ) => {\r\n\t  ports.forEach( ( tempPort ) => {\r\n\t\tif(possibleComNames.includes( tempPort.comName )) {\r\n\t\t  comName = tempPort.comName;\r\n\t\t  port    = new SerialPort( comName );\r\n\t\t  port.pipe( parser );\r\n\t\t  \r\n\t\t  port.on( 'close', function(){\r\n\t\t\tconsole.log( 'Port has been closed.' );\r\n\t\t\tcloseWindow( 'Port has been closed.' );\r\n\t\t  } );\r\n\t\t  \r\n\t\t  // Only inject code when they are on the correct web page\r\n\t\t  // Stream all data coming in from the serial port.\r\n\t\t  parser.on( 'data', function( data ){\r\n\t\t\tlet currentWeight = readLine( data );\r\n\t\t\tconsole.log( \"Current Weight: \", currentWeight );\r\n\t\t\t\r\n\t\t\tlet code = `if(document.getElementById(\"weight\") !== null){\r\n                    document.getElementById(\"weight\").value = \"${currentWeight}\";\r\n                    document.getElementById(\"status\").innerHTML = \"${status}\";\r\n                    document.getElementById(\"units\").innerHTML = \"${units}\";\r\n                    };`;\r\n\t\t\t\r\n\t\t\tif(mainWindow.webContents.getURL().includes( 'tools/weighStation' )) {\r\n\t\t\t  console.log( \"Execute\" );\r\n\t\t\t  mainWindow.webContents.executeJavaScript( code );\r\n\t\t\t}\r\n\t\t  } );\r\n\t\t}\r\n\t  } );\r\n\t} );\r\n  }\r\n  catch(err) {\r\n\tcloseWindow( 'You have lost internet.' );\r\n\tconsole.log( 'I caught a thing. '.err );\r\n  }\r\n}\r\n\r\n\r\n/** BrowserWindow setup and such **/\r\nfunction createWindow(){\r\n  \r\n  // Create the browser window.\r\n  mainWindow = new BrowserWindow( windowOptions );\r\n  \r\n  \r\n  // When in development environment, open the Redux DevTools Extension and the Chrome DevTools.\r\n  // Need to have the Chrome Extension at the location below.\r\n  // If on MAC and have Redux DevTools installed, then it should be at this location.\r\n  if(currentEnvironment === 'DEV') {\r\n\tBrowserWindow.addDevToolsExtension( \"../../Library/Application Support/Google/Chrome/Default/Extensions/lmhkpmbekcpmknklioeibfkpmmfibljd/2.15.1_0/\" );\r\n\t// Open the DevTools.\r\n\tmainWindow.webContents.openDevTools();\r\n\tmainWindow.loadURL( 'http://localhost:3000' );\r\n  }\r\n  else if(currentEnvironment === 'WINDEV') {\r\n\t// Open the DevTools.\r\n\tmainWindow.webContents.openDevTools();\r\n\tmainWindow.loadURL( 'http://localhost:3000' );\r\n  }\r\n  else {\r\n\t// and load the index.html of the app.\r\n\tmainWindow.loadURL( 'https://oms.fulfillment.com/' );\r\n  }\r\n  // Emitted when the window is closed.\r\n  mainWindow.on( 'closed', function(){\r\n\t// Dereference the window object, usually you would store windows\r\n\t// in an array if your app supports multi windows, this is the time\r\n\t// when you should delete the corresponding element.\r\n\tmainWindow = null;\r\n  } );\r\n  mainWindow.webContents.on( 'did-finish-load', function(){\r\n\tinitSerialPort();\r\n  } );\r\n}\r\n\r\n\r\n// This method will be called when Electron has finished\r\n// initialization and is ready to create browser windows.\r\n// Some APIs can only be used after this event occurs.\r\napp.on( 'ready', function(){\r\n  autoUpdater.checkForUpdatesAndNotify();\r\n  createWindow();\r\n} );\r\n\r\n// Quit when all windows are closed.\r\napp.on( 'window-all-closed', function(){\r\n  // On OS X it is common for applications and their menu bar\r\n  // to stay active until the user quits explicitly with Cmd + Q\r\n  app.quit();\r\n} );\r\n\r\napp.on( 'activate', function(){\r\n  // On OS X it's common to re-create a window in the app when the\r\n  // dock icon is clicked and there are no other windows open.\r\n  if(mainWindow === null) {\r\n\tcreateWindow();\r\n  }\r\n} );\r\n"]}